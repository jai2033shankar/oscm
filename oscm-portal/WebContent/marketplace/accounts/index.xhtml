<!-- Copyright FUJITSU LIMITED 2020-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:mp="http://www.fujitsu.com/global/services/software/interstage/marketplace"
      xmlns:adm="http://www.fujitsu.com/global/services/software/interstage"
      xmlns:rich="http://richfaces.org/rich" xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j">

<h:head>
  <c:set var="mpBaseUrl" value="#{facesContext.externalContext.requestContextPath}/marketplace"/>
  <c:set var="isMplRestricted" value="#{marketplaceBean.restricted}"/>
  <ui:insert name="pageId"/>
  <ui:insert name="stage"/>
  <ui:include src="../templates/headBootstrap.xhtml">
    <ui:param name="dirty" value="#{dirty}"/>
  </ui:include>
</h:head>

<ui:define name="pageId">
  <c:set var="pageId" value="marketplace.account"/>
  <c:set var="imgUrl" value="#{facesContext.externalContext.requestContextPath}/marketplace/img"/>
</ui:define>

<h:body>
  <rich:jQuery selector="document" query="ready(function(){AdmUtils.initFocus();AdmUtils.setUIElements()});"/>
  <c:if test="#{not empty firstErrorElement or not empty focusElement}">
    <c:set var="elementId"
           value="#{(not empty firstErrorElement)?firstErrorElement:(empty rich:clientId(focusElement)?focusElement:(rich:clientId(focusElement)))}"/>
    <rich:jQuery selector="document"
                 query="ready(function(){
          var element = document.getElementById('#{elementId}');
          try {element.focus();document.getElementById('contentPanelDiv').scrollIntoView(true);} catch (e) {/* if the element cannot get the focus, ignore it */}
        })"/>
  </c:if>
  <mp:keepAlive interval="#{appBean.interval}"/>

  <a4j:outputPanel id="contentPanelDiv" layout="block">
    <a id="top" name="top"/>

    <!-- header -->
    <mp:headerBootstrap user="#{userBean.loggedInUser}"
                        loginHandler="showLoginPanel('#{defaultLoginRedirect}');return false;"/>
    <ui:include src="../login.xhtml">
      <ui:param name="canCloseLogin" value="#{not isMplRestricted}"/>
    </ui:include>

    <!-- body -->
    <div class="container-fluid navbar-margin">

      <div class="row">
        <div class="aside pr-md-3"></div>
        <div class="list-group list-group-vertical-sm text-center" id="nav-account" role="tablist"
             aria-orientation="vertical">
          <a class="list-group-item list-group-item-secondary list-group-item-action active" id="tabIndex"
             data-toggle="tab" href="#index" role="tab" aria-controls="index">Home</a>
          <a class="list-group-item list-group-item-secondary list-group-item-action active" id="tabProfile"
             data-toggle="tab" href="#profile" role="tab" aria-controls="profile">Profile</a>
          <a class="list-group-item list-group-item-secondary list-group-item-action active" id="tabSettings"
             data-toggle="tab" href="#settings" role="tab" aria-controls="settings">Settings</a>
        </div>
      </div>

      <a4j:outputPanel layout="block" styleClass="box" rendered="#{isSingleContentPage}">

        <ui:insert name="singlecontent"/>
      </a4j:outputPanel>

      <a4j:outputPanel id="localeErrorPanel" layout="block" styleClass="errorPanel" style="display:block"
                       rendered="#{appBean.errorPanelForLocaleShow}">
        <dl class="rich-messages box warning my-2">
          <dt>
              <span class="rich-messages-label">
                <h:outputFormat value="#{msg['warning.supportedlanguage.locale.deactivated']}">
                  <f:param value="#{appBean.oldUserLocale}"/>
                </h:outputFormat>
              </span>
          </dt>
        </dl>
      </a4j:outputPanel>

      <!-- error message container -->
      <a4j:outputPanel id="globalMessagesHolder" class="con-flow-root">
        <a4j:outputPanel id="errorPanel" layout="block" styleClass="errorPanel">
        </a4j:outputPanel>

        <!-- progress message -->
        <a4j:outputPanel id="progressPanel" layout="block" rendered="#{facesContext.maximumSeverity.ordinal == 0}">
          <rich:messages infoClass="infoMsg" layout="list" id="progressMessages" styleClass="box suspended my-2"
                         for="progressPanel" ajaxRendered="false"/>
        </a4j:outputPanel>

        <!-- info messages -->
        <a4j:outputPanel id="infoPanelHolder">
          <a4j:outputPanel id="infoPanel" layout="block" rendered="#{facesContext.maximumSeverity.ordinal == 0}">
            <rich:messages infoClass="infoMsg" passedLabel="" layout="list" id="infoMessages"
                           styleClass="box success my-2" globalOnly="true" ajaxRendered="false"/>
          </a4j:outputPanel>
        </a4j:outputPanel>
        <a4j:outputPanel id="hiddenInfoPanel" layout="block">
        </a4j:outputPanel>

        <!-- if we find an error during the processing of the body,
         we must add the corresponding message to the error container above -->
        <!-- error messages -->
        <a4j:outputPanel id="hiddenErrorPanel" layout="block" styleClass="errorPanel">
          <!-- filter error messages -->
          <c:if test="#{not empty errorKey and not sessionBean.errorMessageDuplicate}">
            <dl class="rich-messages box error" id="errorMessages1">
              <dt>
                <h:outputFormat value="#{msg[errorKey]}">
                  <f:param value="#{errorParam0}"/>
                  <f:param value="#{errorParam1}"/>
                  <f:param value="#{errorParam2}"/>
                  <f:param value="#{errorParam3}"/>
                  <f:param value="#{errorParam4}"/>
                </h:outputFormat>
              </dt>
            </dl>
          </c:if>
          <!-- JSF error messages -->
          <rich:messages id="errorMessages" globalOnly="true" ajaxRendered="false" styleClass="box error my-2"
                         rendered="#{facesContext.maximumSeverity.ordinal > 0}"/>
          <!-- warning messages -->
          <c:if test="#{not empty warningKey}">
            <dl class="rich-messages box warning" id="warningMessages1">
              <dt>
                <h:outputFormat value="#{msg[warningKey]}">
                  <f:param value="#{warningParam0}"/>
                  <f:param value="#{warningParam1}"/>
                  <f:param value="#{warningParam2}"/>
                  <f:param value="#{warningParam3}"/>
                  <f:param value="#{warningParam4}"/>
                </h:outputFormat>
              </dt>
            </dl>
          </c:if>

        </a4j:outputPanel>
      </a4j:outputPanel>

      <div class="tab-content" id="accountTabContent">
        <div id="index" class="tab-pane fade show active pt-4" role="tabpanel" aria-labelledby="nav-index-tab">
          <h:form id="indexForm">
            <a4j:outputPanel id="all" layout="block">
              <div class="row mt-2">
                <a4j:outputPanel id="profile" layout="block" styleClass="col-md-6 col-lg-4 marginBottomDefault"
                                 rendered="#{empty appBean.hiddenUIElements['marketplace.navigation.Profile']}">

                  <div class="card h-100 selectable">
                    <div class="card-header">#{msg['marketplace.account.profile.title']}</div>
                    <div class="card-body">
                      <a4j:outputPanel layout="block" styleClass="accountBox">
                        <a4j:outputPanel id="userName" layout="block" styleClass="mb-2">
                          <h:outputText value="#{msg['user.salutation.MR']} "
                                        rendered="#{organizationBean.currentUser.salutation == 'MR'}"/>
                          <h:outputText value="#{msg['user.salutation.MS']} "
                                        rendered="#{organizationBean.currentUser.salutation == 'MS'}"/>
                          <h:outputText
                              value="#{organizationBean.currentUser.firstName} #{organizationBean.currentUser.lastName}"
                              rendered="#{not sessionBean.nameSequenceReversed}"/>
                          <h:outputText
                              value="#{organizationBean.currentUser.lastName} #{organizationBean.currentUser.firstName}"
                              rendered="#{sessionBean.nameSequenceReversed}"/>
                        </a4j:outputPanel>
                        <a4j:outputPanel layout="block" styleClass="mb-2">
                          <h:outputText value="#{organizationBean.currentUser.email}"/>
                        </a4j:outputPanel>
                        <a4j:outputPanel layout="block" id="organizationName" rendered="#{userBean.loggedInAndAdmin}">
                          <h:outputText value="#{organizationBean.organization.name}" styleClass="preWrapping"/>
                        </a4j:outputPanel>
                      </a4j:outputPanel>
                    </div>
                    <div class="card-footer bg-transparent">
                      <h:link id="editProfileButton" outcome="profile"
                              class="btn btn-sm btn-outline-secondary stretched-link"
                              value="#{msg['marketplace.account.button.show']}"
                              onclick="AdmUtils.showProgress(true);"/>
                    </div>

                  </div>
                </a4j:outputPanel>

                <a4j:outputPanel id="payments" layout="block" styleClass="col-md-6 col-lg-4 marginBottomDefault"
                                 rendered="#{userBean.loggedInAndAdmin and empty appBean.hiddenUIElements['marketplace.navigation.Payment'] and appBean.paymentInfoAvailable}">

                  <div class="card h-100 selectable">
                    <div class="card-header">#{msg['marketplace.account.payments.title']}</div>
                    <div class="card-body">
                      <a4j:outputPanel layout="block" styleClass="accountBox">
                        <h:outputText value="#{msg['marketplace.account.payments.description']}"/>
                      </a4j:outputPanel>
                    </div>

                    <div class="card-footer bg-transparent">
                      <h:link id="showPaymentsButton" outcome="payments"
                              class="btn btn-sm btn-outline-secondary stretched-link"
                              value="#{msg['marketplace.account.button.show']}"
                              onclick="AdmUtils.showProgress(true);"/>
                    </div>
                  </div>
                </a4j:outputPanel>

                <a4j:outputPanel id="subscriptions" layout="block" styleClass="col-md-6 col-lg-4 marginBottomDefault"
                                 rendered="#{(userBean.loggedInAndAdmin or userBean.loggedInAndSubscriptionManager or userBean.loggedInAndUnitAdmin) and empty appBean.hiddenUIElements['marketplace.navigation.Subscriptions']}">

                  <div class="card h-100 selectable">
                    <div class="card-header">#{msg['marketplace.account.subscriptions.title']}</div>
                    <div class="card-body">
                      <a4j:outputPanel layout="block" styleClass="accountBox">
                        <h:outputText value="#{msg['marketplace.account.subscriptions.description']}"/>
                      </a4j:outputPanel>
                    </div>

                    <div class="card-footer bg-transparent">
                      <h:link id="showSubscriptionsButton" outcome="subscriptions"
                              class="btn btn-sm btn-outline-secondary stretched-link"
                              value="#{msg['marketplace.account.button.show']}"
                              onclick="AdmUtils.showProgress(true);"/>
                    </div>
                  </div>
                </a4j:outputPanel>

                <a4j:outputPanel id="users" layout="block" styleClass="col-md-6 col-lg-4 marginBottomDefault"
                                 rendered="#{userBean.loggedInAndAdmin and empty appBean.hiddenUIElements['marketplace.navigation.Users']}">

                  <div class="card h-100 selectable">
                    <div class="card-header">#{msg['marketplace.account.users.title']}</div>
                    <div class="card-body">
                      <a4j:outputPanel layout="block" styleClass="accountBox">
                        <h:outputText value="#{msg['marketplace.account.users.description']}"/>
                        <br/>
                        <br/>
                        <h:outputText value="#{msg['marketplace.account.users.group.description']}"/>
                      </a4j:outputPanel>
                    </div>

                    <div class="card-footer bg-transparent">
                      <h:link id="showUsersButton" outcome="users"
                              class="btn btn-sm btn-outline-secondary stretched-link"
                              value="#{msg['marketplace.account.button.show']}"
                              onclick="AdmUtils.showProgress(true);"/>
                    </div>
                  </div>
                </a4j:outputPanel>

                <a4j:outputPanel id="units" layout="block" styleClass="col-md-6 col-lg-4 marginBottomDefault"
                                 rendered="#{userBean.loggedInAndUnitAdmin and empty appBean.hiddenUIElements['marketplace.navigation.Units']}">

                  <div class="card h-100 selectable">
                    <div class="card-header">#{msg['marketplace.account.units.title']}</div>
                    <div class="card-body">
                      <a4j:outputPanel layout="block" styleClass="accountBox">
                        <h:outputText value="#{msg['marketplace.account.units.description']}"/>
                      </a4j:outputPanel>
                    </div>
                    <div class="card-footer bg-transparent">
                      <h:link id="showUnitsButton" outcome="units"
                              class="btn btn-sm btn-outline-secondary stretched-link"
                              value="#{msg['marketplace.account.button.show']}"
                              onclick="AdmUtils.showProgress(true);"/>
                    </div>
                  </div>
                </a4j:outputPanel>

                <a4j:outputPanel id="reports" layout="block" styleClass="col-md-6 col-lg-4 marginBottomDefault"
                                 rendered="#{accountNavigationBean.reportingAvailable}">

                  <div class="card h-100 selectable">
                    <div class="card-header">#{msg['marketplace.account.reports.title']}</div>
                    <div class="card-body">
                      <a4j:outputPanel layout="block" styleClass="accountBox">
                        <c:forEach items="#{reportBean.filteredReports}" var="report" varStatus="v">
                          <a4j:outputPanel layout="block" styleClass="mb-2">
                            <h:outputLink value="reports.jsf?sr=#{v.index}" id="reportLink#{v.index}">
                              <h:outputText value="#{report.localizedReportName}"/>
                              <br/>
                            </h:outputLink>
                          </a4j:outputPanel>
                        </c:forEach>
                      </a4j:outputPanel>
                    </div>
                    <div class="card-footer bg-transparent">
                      <h:link id="showReportsButton" outcome="reports"
                              class="btn btn-sm btn-outline-secondary stretched-link"
                              value="#{msg['marketplace.account.button.show']}"
                              onclick="AdmUtils.showProgress(true);"/>
                    </div>
                  </div>
                </a4j:outputPanel>

                <a4j:outputPanel id="processes" layout="block" styleClass="col-md-6 col-lg-4 marginBottomDefault"
                                 rendered="#{empty appBean.hiddenUIElements['marketplace.navigation.Processes']}">

                  <div class="card h-100 selectable">
                    <div class="card-header">#{msg['marketplace.account.processes.title']}</div>
                    <div class="card-body">
                      <a4j:outputPanel layout="block" styleClass="accountBox">
                        <h:outputText value="#{msg['marketplace.account.processes.description']}"/>
                      </a4j:outputPanel>
                    </div>
                    <div class="card-footer bg-transparent">
                      <h:link id="showProcessesButton" outcome="processes"
                              class="btn btn-sm btn-outline-secondary stretched-link"
                              value="#{msg['marketplace.account.button.show']}"
                              onclick="AdmUtils.showProgress(true);"/>
                    </div>
                  </div>
                </a4j:outputPanel>

                <a4j:outputPanel id="operations" layout="block" styleClass="col-md-6 col-lg-4 marginBottomDefault"
                                 rendered="#{empty appBean.hiddenUIElements['marketplace.navigation.Operations']}">

                  <div class="card h-100 selectable">
                    <div class="card-header">#{msg['marketplace.account.operations.title']}</div>
                    <div class="card-body">
                      <a4j:outputPanel layout="block" styleClass="accountBox">
                        <h:outputText value="#{msg['marketplace.account.operations.description']}"/>
                      </a4j:outputPanel>
                    </div>
                    <div class="card-footer bg-transparent">
                      <h:link id="showOperationsButton" outcome="operations"
                              class="btn btn-sm btn-outline-secondary stretched-link"
                              value="#{msg['marketplace.account.button.show']}"
                              onclick="AdmUtils.showProgress(true);"/>
                    </div>
                  </div>
                </a4j:outputPanel>

                <a4j:outputPanel id="administration" layout="block" styleClass="col-md-6 col-lg-4 marginBottomDefault"
                                 rendered="#{userBean.administrationAccess and empty appBean.hiddenUIElements['marketplace.navigation.Administration']}">

                  <div class="card h-100 selectable">
                    <div class="card-header">#{msg['marketplace.account.administration.title']}</div>
                    <div class="card-body">
                      <a4j:outputPanel layout="block" styleClass="accountBox">
                        <h:outputText value="#{msg['marketplace.account.administration.description']}"/>
                      </a4j:outputPanel>
                    </div>
                    <div class="card-footer bg-transparent">
                      <h:link id="showAdministrationButton" class="btn btn-sm btn-outline-secondary stretched-link"
                              value="#{msg['marketplace.account.button.show']}"
                              onclick="AdmUtils.showProgress(true);location.href='#{userBean.adminPortalAddress}';return false;"/>
                    </div>
                  </div>
                </a4j:outputPanel>
              </div>
            </a4j:outputPanel>
          </h:form>
        </div>
        <div id="profile" class="tab-pane fade show active pt-4" role="tabpanel" aria-labelledby="nav-profile-tab">
          <h:form id="profileForm">
            <h:form id="validateCurrentUserRolesForm">
              <a4j:jsFunction name="validateCurrentUserRoles" data="#{organizationBean.currentUserRolesChanged}"
                              oncomplete="if(event.data==true){#{rich:component('reLogining')}.show();}
                     else{setOnSubmit(true);setDirty(false);
                     #{rich:element('saveButton')}.click();setOnSubmit(false);} return false;">
              </a4j:jsFunction>
            </h:form>

            <div id="all" class="row">
              <div class="my-2 p-3 bg-light col">
                <mp:outputStep value="#{msg['marketplace.account.profile.title']}"/>

                <h:inputHidden value="#{sessionBean.selectedTab}"/>

                <div class="list-group list-group-horizontal-sm text-center" id="nav-tab" role="tablist">
                  <a class="list-group-item list-group-item-secondary list-group-item-action active" id="tabUser"
                     data-toggle="tab"
                     href="#user" role="tab" aria-controls="user"
                     onclick="setSelectedTab('tabUser');">#{msg['marketplace.account.profile.userTab']}</a>
                  <c:if
                      test="#{userBean.isOrganizationAdmin and empty appBean.hiddenUIElements['organization.edit.organizationData']}">
                    <a class="list-group-item list-group-item-secondary list-group-item-action" id="tabOrg"
                       data-toggle="tab"
                       href="#org" aria-controls="org" aria-selected="false"
                       role="tab" onclick="setSelectedTab('tabOrg');">#{msg['marketplace.account.profile.organizationTab']}</a>
                  </c:if>
                  <c:if test="#{userBean.isOrganizationAdmin}">
                    <a class="list-group-item list-group-item-secondary list-group-item-action" id="tabAttr"
                       data-toggle="tab"
                       aria-selected="false" role="tab" aria-controls="attr"
                       href="#attr" onclick="setSelectedTab('tabAttr');">#{msg['marketplace.account.profile.attributeTab']}</a>
                  </c:if>
                </div>

                <div class="tab-content" id="myTabContent">
                  <div id="user" class="tab-pane fade show active pt-4" role="tabpanel"
                       aria-labelledby="nav-user-tab">
                    <h:form id="userForm">
                      <div class="row">
                        <div class="col-md-9">
                          <h2>
                            <adm:outputStep value="#{msg['organization.edit.userProfile']}"/>
                            <mp:pixelline
                                rendered="#{not organizationBean.currentUser.remoteLdapActive and userBean.internalAuthMode}"/>
                          </h2>
                        </div>
                        <a4j:outputPanel layout="block" styleClass="row col-md-3 justify-content-end"
                                         rendered="#{not organizationBean.currentUser.remoteLdapActive and userBean.internalAuthMode}">
                          <adm:buttonCustomizedOnClickBootstrap id="changePwdButton"
                                                                value="#{msg['button.changePassword']}"
                                                                onclick="showLoginPanel('');return false;"
                                                                buttonStyleClass="btn btn-sm btn-outline-secondary w-sm-100"
                                                                buttonType="execute"/>
                        </a4j:outputPanel>
                      </div>

                      <mp:formLabel id="userId" label="#{msg['user.userId']}"
                                    label2="#{organizationBean.currentUser.userId}"/>

                      <mp:formLabel id="userGroups" label="#{msg['user.userGroup']}"
                                    label2="#{organizationBean.currentUser.groupsToDisplay}"/>

                      <mp:formSelect id="salutation" label="#{msg['user.salutation']}"
                                     value="#{organizationBean.currentUser.salutation}" selectStyle="custom-select">
                        <adm:salutationItems/>
                      </mp:formSelect>

                      <mp:formUserName firstNameId="firstName"
                                       firstNameValue="#{organizationBean.currentUser.firstName}"
                                       lastNameId="lastName" lastNameValue="#{organizationBean.currentUser.lastName}"
                                       firstNameDisabled="#{organizationBean.currentUser.firstNameDisabled}"
                                       lastNameDisabled="#{organizationBean.currentUser.lastNameDisabled}"
                                       inputStyle="form-control"/>

                      <adm:formInput id="email" label="#{msg['user.email']}" required="true" inputStyle="form-control"
                                     value="#{organizationBean.currentUser.email}" maxlength="#{appBean.nameLen}"
                                     disabled="#{organizationBean.currentUser.emailDisabled}" validatorId="email"
                                     converterId="trimConverter"/>

                      <mp:formSelect id="locale" label="#{msg['user.locale']}" showHint="true"
                                     value="#{organizationBean.currentUser.locale}" selectStyle="custom-select">
                        <adm:localeItems/>
                        <f:validator validatorId="SupportedLanguageValidator"/>
                      </mp:formSelect>

                      <hr/>
                      <a4j:outputPanel styleClass="row justify-content-end">
                        <adm:buttonBootstrap id="saveUserButton" value="#{msg['button.save']}"
                                             bean="#{organizationBean}"
                                             onclick="validateCurrentUserRoles();return false;"
                                             styleClass="btn btn-secondary mr-4" action="save"/>
                      </a4j:outputPanel>
                    </h:form>
                  </div>

                  <div id="org" class="tab-pane fade pt-4" role="tabpanel" aria-labelledby="nav-org-tab">
                    <h:form id="orgForm">
                      <h2>
                        <adm:outputStep value="#{msg['organization.edit.organizationData']}"/>
                      </h2>
                      <hr/>

                      <mp:formLabel id="organizationId" label2="#{organizationBean.organization.organizationId}"
                                    label="#{msg['organization.organizationId']}"/>

                      <adm:formInput id="organizationName" label="#{msg['organization.name']}"
                                     converterId="trimConverter"
                                     required="#{organizationBean.currentUser.supplier or organizationBean.currentUser.technologyProvider}"
                                     value="#{organizationBean.organization.name}" inputStyle="form-control"
                                     maxlength="#{appBean.nameLen}"/>

                      <adm:formInput id="organizationEmail" label="#{msg['organization.email']}"
                                     inputStyle="form-control"
                                     required="#{organizationBean.currentUser.supplier or organizationBean.currentUser.technologyProvider}"
                                     onchange="setDirty(true)" value="#{organizationBean.organization.email}"
                                     maxlength="#{appBean.nameLen}" validatorId="email" converterId="trimConverter"/>

                      <adm:formTextarea id="organizationAddress" label="#{msg['organization.address']}"
                                        required="#{organizationBean.currentUser.supplier or organizationBean.currentUser.technologyProvider}"
                                        value="#{organizationBean.organization.address}" converterId="trimConverter"
                                        maxlength="#{appBean.descriptionLen}" areaStyle="form-control"/>

                      <mp:formSelect id="country" label="#{msg['common.country']}" selectStyle="custom-select"
                                     value="#{organizationBean.organization.domicileCountry}"
                                     required="true">
                        <adm:countryItems
                            supportedCountries="#{countryBean.supportedCountryCodesForEditProfilePage}"/>
                      </mp:formSelect>

                      <hr/>
                      <a4j:outputPanel styleClass="row justify-content-end">
                        <adm:buttonBootstrap id="saveOrgButton" value="#{msg['button.save']}"
                                             bean="#{organizationBean}"
                                             action="save" onclick="validateCurrentUserRoles();return false;"
                                             styleClass="btn btn-secondary mr-4"/>
                      </a4j:outputPanel>
                    </h:form>
                  </div>

                  <div id="attr" class="tab-pane fade pt-4" role="tabpanel" aria-labelledby="nav-attr-tab">
                    <h:form id="attrForm">
                      <h2>
                        <adm:outputStep value="#{msg['marketplace.account.profile.attributes.title']}"/>
                      </h2>

                      <a4j:outputPanel id="attributesTablePanel" layout="block"
                                       styleClass="tablePanel table_padding minimumSizeTable">

                        <c:set var="sortIconAscending"
                               value="/marketplace/img/transparentPixel.png?id=sortAscending"/>
                        <c:set var="sortIconDescending"
                               value="/marketplace/img/transparentPixel.png?id=sortDescending"/>

                        <rich:dataTable headerClass="rowTitle" rowClasses="rowOdd,rowEven" id="attributesTable"
                                        width="100%"
                                        rows="10" value="#{manageAttributesCtrl.model.attributes}" var="item"
                                        selectionMode="single" enableContextMenu="false" noDataLabel=" "
                                        columnClasses="alignTop wrapColumns preWrapping"
                                        styleClass="table table-striped table-hover table-bordered sortable"
                                        render="pagerPanel"
                                        rendered="#{(not empty manageAttributesCtrl.model.attributes)}"
                                        sortMode="single">

                          <rich:column styleClass="d-lg-none col-icon" headerClass="d-lg-none">
                            <rich:collapsibleSubTableToggler for="sbtbl"/>
                          </rich:column>

                          <rich:column id="colUdaName" width="#{mediumWidth}" sortBy="#{item.udaNameToShow}"
                                       sortIconAscending="#{sortIconAscending}"
                                       sortIconDescending="#{sortIconDescending}"
                                       sortOrder="#{tableState.sortOrders['mpColUdaName']}" sortIcon="#{sortIcon}"
                                       filterType="custom" filterValue="#{tableState.filterValues['colUdaName']}"
                                       filterExpression="#{adm:matchBegin(item.udaNameToShow, tableState.filterValues['colUdaName'], false)}">
                            <f:facet name="header">
                              <h:outputText value="#{msg['marketplace.account.profile.attributes.udaName']}"/>
                              <hr class="my-1"/>
                              <adm:filterInputBootstrap inputValue="#{tableState.filterValues['colUdaName']}"
                                                        render="attributesTable@body pagerPanel"
                                                        inputId="filterUdaName"
                                                        onkeyup="AdmUtils.setFirstPage(#{rich:element('attributePager')});"/>
                            </f:facet>
                            <h:outputText value="#{item.udaNameToShow}"/>
                          </rich:column>

                          <rich:column id="colVendor" width="#{mediumWidth}" sortBy="#{item.vendor.name}"
                                       sortIcon="#{sortIcon}"
                                       sortIconAscending="#{sortIconAscending}"
                                       sortIconDescending="#{sortIconDescending}"
                                       sortOrder="#{tableState.sortOrders['mpColVendor']}"
                                       styleClass="d-none d-lg-table-cell"
                                       filterType="custom" filterValue="#{tableState.filterValues['colVendor']}"
                                       filterExpression="#{adm:matchBegin(item.vendor.name, tableState.filterValues['colVendor'], false)}"
                                       headerClass="d-none d-lg-table-cell">
                            <f:facet name="header">
                              <h:outputText value="#{msg['marketplace.account.profile.attributes.vendor']}"/>
                              <hr class="my-1"/>
                              <adm:filterInputBootstrap inputId="filterVendor"
                                                        inputValue="#{tableState.filterValues['colVendor']}"
                                                        render="attributesTable@body pagerPanel"
                                                        onkeyup="AdmUtils.setFirstPage(#{rich:element('attributePager')});"/>
                            </f:facet>
                            <h:outputText value="#{item.vendor.name}"/>
                          </rich:column>

                          <c:set var="scopeKey" value="UdaConfigurationType.#{item.udaDefinition.configurationType}"/>

                          <rich:column width="#{smallWidth}" sortBy="#{item.udaDefinition.configurationType}"
                                       sortIcon="#{sortIcon}"
                                       sortIconAscending="#{sortIconAscending}"
                                       sortIconDescending="#{sortIconDescending}"
                                       styleClass="d-none d-sm-table-cell"
                                       headerClass="align-top d-none d-sm-table-cell">
                            <f:facet name="header">
                              <h:outputText value="#{msg['marketplace.account.profile.attributes.scope']}"/>
                              <hr class="my-1"/>
                            </f:facet>
                            <h:outputText value="#{msg[scopeKey]}"/>
                          </rich:column>

                          <rich:column id="colUdaValue" width="#{restWidth}" sortBy="#{item.udaValue}"
                                       sortIcon="#{sortIcon}"
                                       sortIconAscending="#{sortIconAscending}"
                                       sortIconDescending="#{sortIconDescending}"
                                       sortOrder="#{tableState.sortOrders['mpColUdaValue']}" styleClass="p-1"
                                       filterType="custom" filterValue="#{tableState.filterValues['colUdaValue']}"
                                       filterExpression="#{adm:matchBegin(item.udaValueToShow, tableState.filterValues['colUdaValue'], false)}">
                            <f:facet name="header">
                              <h:outputText value="#{msg['marketplace.account.profile.attributes.value']}"/>
                              <hr class="my-1"/>
                              <adm:filterInputBootstrap inputValue="#{tableState.filterValues['colUdaValue']}"
                                                        render="attributesTable@body pagerPanel"
                                                        inputId="filterUdaValue"
                                                        onkeyup="AdmUtils.setFirstPage(#{rich:element('attributePager')});"/>
                            </f:facet>
                            <h:inputText id="udaValueClear" onchange="setDirty(true)" value="#{item.udaValue}"
                                         maxlength="#{appBean.descriptionLen}" required="#{item.inputMandatory}"
                                         label="#{item.udaId}" styleClass="form-control form-control-sm"
                                         rendered="#{not item.inputEncrypted}">
                            </h:inputText>
                            <h:inputSecret id="udaValuePassword" onchange="setDirty(true)"
                                           value="#{item.passwordValueToStore}"
                                           maxlength="#{appBean.descriptionLen}" required="#{item.inputMandatory}"
                                           redisplay="true" styleClass="form-control form-control-sm"
                                           label="#{item.udaId}"
                                           rendered="#{item.inputEncrypted}">
                            </h:inputSecret>
                          </rich:column>

                          <f:facet name="footer">
                            <a4j:outputPanel>
                              <adm:pagerBootstrap pagerId="attributePager"/>
                            </a4j:outputPanel>
                          </f:facet>

                          <rich:collapsibleSubTable id="sbtbl" value="#{manageAttributesCtrl.model.attributes}"
                                                    var="item"
                                                    expandMode="client" expanded="#{false}" rows="1">
                            <rich:column colspan="4">
                              <div class="row d-lg-none py-1">
                                <div class="col-4 pl-4">
                                  <h:outputText value="#{msg['marketplace.account.profile.attributes.vendor']}:"
                                                styleClass="font-weight-bold"/>
                                </div>
                                <div class="col-8">
                                  <h:outputText value="#{item.vendor.name}" styleClass="font-weight-bold"/>
                                </div>
                              </div>
                              <tr class="d-none"/>
                              <tr class="d-sm-none">
                                <th colspan="4">
                                  <div class="row d-sm-none p-2">
                                    <div class="col-4">#{msg['marketplace.account.profile.attributes.scope']}:</div>
                                    <div class="col-8">
                                      <h:outputText value="#{msg[scopeKey]}" styleClass="font-weight-bold"/>
                                    </div>
                                  </div>
                                </th>
                              </tr>
                            </rich:column>
                          </rich:collapsibleSubTable>

                        </rich:dataTable>
                      </a4j:outputPanel>

                      <br/>
                      <hr/>
                      <a4j:outputPanel styleClass="row justify-content-end">
                        <adm:buttonBootstrap id="saveAttrButton" value="#{msg['button.save']}"
                                             bean="#{manageAttributesCtrl}"
                                             rendered="#{(not empty manageAttributesCtrl.model.attributes)}"
                                             styleClass="btn btn-secondary mr-4" action="saveAttributes"/>
                      </a4j:outputPanel>
                    </h:form>
                  </div>

                </div>
                <h:form>
                  <a4j:jsFunction name="setSelectedTab">
                    <a4j:param name="param1" assignTo="#{sessionBean.selectedTab}"/>
                  </a4j:jsFunction>
                </h:form>
              </div>

              <script>
        document.addEventListener("DOMContentLoaded", function(){
          $(this).scrollTop(0);
        });

              </script>

              <mp:reloginConfirmPanel/>
            </div>

            <link href="#{facesContext.externalContext.requestContextPath}/css/dataTable.css" rel="stylesheet"
                  type="text/css" media="all"/>

            <script>AdmUtils.sessionTab('#{sessionBean.selectedTab}', 'nav-tab');</script>
          </h:form>
        </div>
        <div id="settings" class="tab-pane fade show active pt-4" role="tabpanel" aria-labelledby="nav-settings-tab">
          <h:form id="settingsForm">...</h:form>
        </div>
      </div>
    </div>
  </a4j:outputPanel>
<c:set var="bootstrapUrl" value="#{sessionBean.customBootstrapUrl}"/>

<footer class="bootstrap_footer">

  <div class="container-fluid text-center py-3">
    <ul>
      <li class="firstchild"><a id="imprintLink" href="#{imprintUrl}"
                                onclick="if(#{isMplRestricted and empty userBean.loggedInUser}){showLoginPanel('/marketplace/terms/imprint.jsf');return false;}"
                                target="_blank">
        <h:outputText
            value="#{msg['marketplace.imprint.title']}"/>
      </a>
      </li>
      <li><a href="#{mpBaseUrl}/terms/terms.jsf"
             onclick="if(#{isMplRestricted and empty userBean.loggedInUser}){showLoginPanel('/marketplace/terms/terms.jsf');return false;}">
        <h:outputText value="#{msg['marketplace.terms.title']}"/>
      </a>
      </li>
      <li><a id="privacyPolicyLink" href="#{mpBaseUrl}/terms/privacypolicy.jsf"
             onclick="if(#{isMplRestricted and empty userBean.loggedInUser}){showLoginPanel('/marketplace/terms/privacypolicy.jsf');return false;}">
        <h:outputText
            value="#{msg['marketplace.privacypolicy.title']}"/>
      </a>
      </li>
    </ul>
  </div>

  <script type="text/javascript">
    <c:forEach items="#{additionalErrorElements}" var="ee">
      AdmUtils.setHighlight("#{ee}");
    </c:forEach>
    AdmUtils.contentsTitle();
    AdmUtils.setInfoPanel("progressMessages");
    AdmUtils.setInfoPanel("infoMessages");

    var currentViewId = "#{facesContext.viewRoot.viewId}";
    var recoverPasswordView = currentViewId.indexOf("recoverPassword.xhtml");
    var confirmRecoverPasswordView = currentViewId.indexOf("confirmStartPwdRecovery.xhtml");
    if(#{isMplRestricted and empty userBean.loggedInUser and userBean.internalAuthMode}){
      if (recoverPasswordView == -1 &amp;&amp; confirmRecoverPasswordView == -1) {
    	  showLoginPanel('/marketplace/index.jsf');
    	}
    }
    $(document).ready(function() {
       if(#{isMplRestricted and empty userBean.loggedInUser and not userBean.internalAuthMode}){
      document.getElementById('formLogin:loginLink').click();
    }
    });

    AdmUtils.sortSelect();


  </script>
  <h:outputText escape="false" value="#{trackingCodeCtrl.trackingCodeForCurrentMarketplace}"/>

  <link href="${bootstrapUrl}/css/darkFooter.css" rel="stylesheet"
        type="text/css"/>
  <script type="text/javascript"
          src="#{facesContext.externalContext.requestContextPath}/scripts/missingViewState.patch.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
  <script type="text/javascript"
          src="${facesContext.externalContext.requestContextPath}/bootstrap/js/bootstrap.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css"/>
  <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css"/>
</footer>
</h:body>
</html>